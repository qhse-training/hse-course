<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç: –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --error: #e74c3c;
            --warning: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .test-header {
            background: var(--primary);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .test-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .course-info {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .test-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 0 10px;
            font-size: 14px;
        }
        
        .timer {
            background: var(--warning);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .progress-container {
            width: 100%;
            background: #eee;
            height: 10px;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s;
        }
        
        .question-container {
            padding: 30px;
        }
        
        .question {
            margin-bottom: 25px;
            padding: 25px;
            border: 2px solid #eee;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .question.active {
            border-color: var(--secondary);
            background: #f8f9fa;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
        }
        
        .question-number {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .question-text {
            font-size: 20px;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #2c3e50;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .option:hover {
            border-color: var(--secondary);
            background: #f0f8ff;
            transform: translateX(5px);
        }
        
        .option.selected {
            border-color: var(--secondary);
            background: #e3f2fd;
        }
        
        .option.correct {
            border-color: var(--success);
            background: #e8f5e9;
        }
        
        .option.incorrect {
            border-color: var(--error);
            background: #ffebee;
        }
        
        .option input {
            display: none;
        }
        
        .option-label {
            width: 32px;
            height: 32px;
            border: 2px solid #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .option.selected .option-label {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .option-text {
            flex: 1;
            font-size: 18px;
            line-height: 1.4;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }
        
        .nav-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            background: var(--secondary);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .submit-btn {
            background: var(--success);
        }
        
        .submit-btn:hover {
            background: #27ae60;
        }
        
        .results-container {
            padding: 40px;
            text-align: center;
        }
        
        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 12px solid;
            position: relative;
        }
        
        .score-percent {
            font-size: 48px;
            font-weight: bold;
        }
        
        .score-label {
            font-size: 18px;
            margin-top: 5px;
            color: #666;
        }
        
        .score-passed {
            border-color: var(--success);
            background: #e8f5e9;
        }
        
        .score-passed .score-percent {
            color: var(--success);
        }
        
        .score-failed {
            border-color: var(--error);
            background: #ffebee;
        }
        
        .score-failed .score-percent {
            color: var(--error);
        }
        
        .results-details {
            margin: 30px 0;
            text-align: left;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            font-size: 16px;
        }
        
        .certificate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 30px 0;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .certificate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .question-counter {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary);
            background: #f0f8ff;
            padding: 8px 16px;
            border-radius: 20px;
        }
        
        .test-requirements {
            background: #fff8e1;
            border: 2px solid #ffd54f;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 16px;
        }
        
        .requirement-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .requirement-item i {
            color: #ff9800;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 id="testTitle">–¢–µ—Å—Ç: –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h1>
            <div class="course-info" id="courseInfo"></div>
            
            <div class="test-requirements" id="requirementsInfo" style="display: none;">
                <h3 style="margin-bottom: 10px; color: #ff6f00;">‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞:</h3>
                <div class="requirement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã –∫—É—Ä—Å–∞ (100%)</span>
                </div>
                <div class="requirement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–±—Ä–∞—Ç—å 100% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</span>
                </div>
                <div class="requirement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Å–¥–∞—á–µ –±—É–¥–µ—Ç –≤—ã–¥–∞–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</span>
                </div>
            </div>
            
            <div class="test-info">
                <div>–í–æ–ø—Ä–æ—Å–æ–≤: <span id="totalQuestions">0</span></div>
                <div class="timer" id="timer">‚è∞ 60:00</div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
        
        <div id="testContent">
            <div class="loading">
                <div class="loader"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–∞...</p>
            </div>
        </div>
        
        <div class="navigation" id="navigation" style="display: none;">
            <button class="nav-btn" id="prevBtn" onclick="prevQuestion()">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
            </button>
            <div class="question-counter">
                –í–æ–ø—Ä–æ—Å <span id="currentQuestionNum">1</span> –∏–∑ <span id="totalQuestionsNum">0</span>
            </div>
            <button class="nav-btn" id="nextBtn" onclick="nextQuestion()">
                –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDQXNLAsqmSlAjplpdl2anPSyiDxbz3CjY",
            authDomain: "qhse-training.firebaseapp.com",
            projectId: "qhse-training",
            storageBucket: "qhse-training.appspot.com",
            messagingSenderId: "4501351718",
            appId: "1:4501351718:web:503b00c9ac052b58e2e5e7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Test data - 20 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∫—É—Ä—Å–∞ "–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
        const correctAnswers = {
            1: 'b', 2: 'c', 3: 'a', 4: 'd', 5: 'b',
            6: 'c', 7: 'a', 8: 'b', 9: 'd', 10: 'a',
            11: 'c', 12: 'b', 13: 'd', 14: 'a', 15: 'c',
            16: 'b', 17: 'd', 18: 'a', 19: 'c', 20: 'b'
        };

        // Test questions - 20 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ–º–µ "–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
        const testQuestions = [
            {
                id: 1,
                question: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π?",
                options: [
                    { id: 'a', text: "–ü–µ—Ä–µ—á–µ–Ω—å –≤—Å–µ—Ö –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ" },
                    { id: 'b', text: "–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π –æ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –¥–æ –Ω–∞–∏–º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö" },
                    { id: 'c', text: "–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã" },
                    { id: 'd', text: "–ò–µ—Ä–∞—Ä—Ö–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" }
                ]
            },
            {
                id: 2,
                question: "–ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º?",
                options: [
                    { id: 'a', text: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" },
                    { id: 'b', text: "–°—Ä–µ–¥—Å—Ç–≤–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã" },
                    { id: 'c', text: "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏" },
                    { id: 'd', text: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–µ –∑–Ω–∞–∫–∏" }
                ]
            },
            {
                id: 3,
                question: "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Ç—Ä–æ–ª—è '–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ'?",
                options: [
                    { id: 'a', text: "–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–∑ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞" },
                    { id: 'b', text: "–ó–∞–º–µ–Ω–∞ –æ–ø–∞—Å–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –º–µ–Ω–µ–µ –æ–ø–∞—Å–Ω—ã–º" },
                    { id: 'c', text: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞—â–∏—Ç–Ω—ã—Ö –æ–≥—Ä–∞–∂–¥–µ–Ω–∏–π" },
                    { id: 'd', text: "–û–±—É—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –º–µ—Ç–æ–¥–∞–º —Ä–∞–±–æ—Ç—ã" }
                ]
            },
            {
                id: 4,
                question: "–ü—Ä–∏–º–µ—Ä–æ–º –∫–∞–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–Ω–µ–µ —Ç–æ–∫—Å–∏—á–Ω–æ–≥–æ —Ö–∏–º–∏–∫–∞—Ç–∞?",
                options: [
                    { id: 'a', text: "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ" },
                    { id: 'b', text: "–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –º–µ—Ä—ã" },
                    { id: 'c', text: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" },
                    { id: 'd', text: "–ó–∞–º–µ—â–µ–Ω–∏–µ" }
                ]
            },
            {
                id: 5,
                question: "–ö–∞–∫–∏–µ –º–µ—Ä—ã –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–º –º–µ—Ç–æ–¥–∞–º –∫–æ–Ω—Ç—Ä–æ–ª—è?",
                options: [
                    { id: 'a', text: "–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π" },
                    { id: 'b', text: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏, –∑–∞—â–∏—Ç–Ω—ã—Ö –æ–≥—Ä–∞–∂–¥–µ–Ω–∏–π, —Å–∏—Å—Ç–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏" },
                    { id: 'c', text: "–í—ã–¥–∞—á–∞ —Å—Ä–µ–¥—Å—Ç–≤ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã" },
                    { id: 'd', text: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞" }
                ]
            },
            {
                id: 6,
                question: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π?",
                options: [
                    { id: 'a', text: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—Ç–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤" },
                    { id: 'b', text: "–í—ã–¥–∞—á–∞ –°–ò–ó —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º" },
                    { id: 'c', text: "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä, –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ä–∞–±–æ—Ç—ã, –æ–±—É—á–µ–Ω–∏–µ" },
                    { id: 'd', text: "–£–¥–∞–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" }
                ]
            },
            {
                id: 7,
                question: "–ù–∞ –∫–∞–∫–æ–º —É—Ä–æ–≤–Ω–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã?",
                options: [
                    { id: 'a', text: "–ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º, –Ω–∞–∏–º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–º —É—Ä–æ–≤–Ω–µ" },
                    { id: 'b', text: "–ù–∞ –≤—Ç–æ—Ä–æ–º —É—Ä–æ–≤–Ω–µ –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è" },
                    { id: 'c', text: "–ù–∞ —Ç—Ä–µ—Ç—å–µ–º —É—Ä–æ–≤–Ω–µ –ø–æ—Å–ª–µ –∑–∞–º–µ—â–µ–Ω–∏—è" },
                    { id: 'd', text: "–ù–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å" }
                ]
            },
            {
                id: 8,
                question: "–ü–æ—á–µ–º—É –°–ò–ó —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–∞–∏–º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –∫–æ–Ω—Ç—Ä–æ–ª—è?",
                options: [
                    { id: 'a', text: "–û–Ω–∏ —Å–∞–º—ã–µ –¥–µ—à–µ–≤—ã–µ" },
                    { id: 'b', text: "–û–Ω–∏ –Ω–µ —É—Å—Ç—Ä–∞–Ω—è—é—Ç –æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–º" },
                    { id: 'c', text: "–ò—Ö —Å–ª–æ–∂–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏" },
                    { id: 'd', text: "–û–Ω–∏ —Ç—Ä–µ–±—É—é—Ç —á–∞—Å—Ç–æ–π –∑–∞–º–µ–Ω—ã" }
                ]
            },
            {
                id: 9,
                question: "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø '–∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤–∞–∂–Ω–µ–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π'?",
                options: [
                    { id: 'a', text: "–í—Å–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –Ω–æ—Å–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –°–ò–ó" },
                    { id: 'b', text: "–ó–∞—â–∏—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è –≤—Å–µ–π –≥—Ä—É–ø–ø—ã —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ" },
                    { id: 'c', text: "–ö–∞–∂–¥—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫ —Å–∞–º –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" },
                    { id: 'd', text: "–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –°–ò–ó" }
                ]
            },
            {
                id: 10,
                question: "–ü—Ä–∏–º–µ—Ä–æ–º –∫–∞–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —à—É–º–æ–∑–∞—â–∏—Ç–Ω–æ–≥–æ –∫–æ–∂—É—Ö–∞ –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ?",
                options: [
                    { id: 'a', text: "–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" },
                    { id: 'b', text: "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ" },
                    { id: 'c', text: "–ó–∞–º–µ—â–µ–Ω–∏–µ" },
                    { id: 'd', text: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" }
                ]
            },
            {
                id: 11,
                question: "–ß—Ç–æ —Ç–∞–∫–æ–µ '–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ' –∫–∞–∫ –º–µ—Ç–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è?",
                options: [
                    { id: 'a', text: "–£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –æ–ø–∞—Å–Ω–æ—Å—Ç–∏" },
                    { id: 'b', text: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏—Ö –∑–Ω–∞–∫–æ–≤" },
                    { id: 'c', text: "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –≤ –æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã" },
                    { id: 'd', text: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è" }
                ]
            },
            {
                id: 12,
                question: "–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –≤ –æ–ø–∞—Å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö?",
                options: [
                    { id: 'a', text: "–ó–∞–º–µ—â–µ–Ω–∏–µ" },
                    { id: 'b', text: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" },
                    { id: 'c', text: "–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" },
                    { id: 'd', text: "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ" }
                ]
            },
            {
                id: 13,
                question: "–ß—Ç–æ —Ç–∞–∫–æ–µ '–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è'?",
                options: [
                    { id: 'a', text: "–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è" },
                    { id: 'b', text: "–ú–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π" },
                    { id: 'c', text: "–°—Ä–µ–¥—Å—Ç–≤–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã" },
                    { id: 'd', text: "–ú–µ—Ç–æ–¥—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –ø—Ä–∏ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö" }
                ]
            },
            {
                id: 14,
                question: "–ö–∞–∫ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏?",
                options: [
                    { id: 'a', text: "–ü–æ —Å—Ç–µ–ø–µ–Ω–∏ —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∏—Å–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤" },
                    { id: 'b', text: "–ü–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏" },
                    { id: 'c', text: "–ü–æ –ø—Ä–æ—Å—Ç–æ—Ç–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è" },
                    { id: 'd', text: "–ü–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é" }
                ]
            },
            {
                id: 15,
                question: "–ß—Ç–æ —Ç–∞–∫–æ–µ '–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è'?",
                options: [
                    { id: 'a', text: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞" },
                    { id: 'b', text: "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –æ—Ç –±–æ–ª–µ–µ –∫ –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º" },
                    { id: 'c', text: "–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã" },
                    { id: 'd', text: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤" }
                ]
            },
            {
                id: 16,
                question: "–ü—Ä–∏–º–µ—Ä–æ–º –∫–∞–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–ø–∞—Å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞?",
                options: [
                    { id: 'a', text: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" },
                    { id: 'b', text: "–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å" },
                    { id: 'c', text: "–ó–∞–º–µ—â–µ–Ω–∏–µ" },
                    { id: 'd', text: "–°–ò–ó" }
                ]
            },
            {
                id: 17,
                question: "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø '–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏'?",
                options: [
                    { id: 'a', text: "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é" },
                    { id: 'b', text: "–û–±—É—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –º–µ—Ç–æ–¥–∞–º" },
                    { id: 'c', text: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏" },
                    { id: 'd', text: "–í–∫–ª—é—á–µ–Ω–∏–µ –º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞" }
                ]
            },
            {
                id: 18,
                question: "–ö–∞–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–æ–≤ –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è?",
                options: [
                    { id: 'a', text: "–ö–∞—Ä—Ç–∞ –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤" },
                    { id: 'b', text: "–¢—Ä—É–¥–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä" },
                    { id: 'c', text: "–ñ—É—Ä–Ω–∞–ª –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π" },
                    { id: 'd', text: "–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã" }
                ]
            },
            {
                id: 19,
                question: "–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª—è?",
                options: [
                    { id: 'a', text: "–ß—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" },
                    { id: 'b', text: "–ü–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ —Ç—Ä–µ–±—É—é—Ç –µ–∂–µ–≥–æ–¥–Ω–æ–≥–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞" },
                    { id: 'c', text: "–£—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —Ä–∏—Å–∫–∏ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è" },
                    { id: 'd', text: "–ß—Ç–æ–±—ã —Å–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏—Ü" }
                ]
            },
            {
                id: 20,
                question: "–ö—Ç–æ –¥–æ–ª–∂–µ–Ω —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –≤—ã–±–æ—Ä–µ –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π?",
                options: [
                    { id: 'a', text: "–¢–æ–ª—å–∫–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å" },
                    { id: 'b', text: "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞, —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ –∏ —Å–∞–º–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏" },
                    { id: 'c', text: "–¢–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã" },
                    { id: 'd', text: "–¢–æ–ª—å–∫–æ –∏–Ω–∂–µ–Ω–µ—Ä—ã-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫–∏" }
                ]
            }
        ];

        // Global variables
        let currentUser = null;
        let courseId = null;
        let courseData = null;
        let userAnswers = {};
        let currentQuestionIndex = 0;
        let timeLeft = 60 * 60; // 60 minutes in seconds
        let timerInterval = null;
        let testCompleted = false;

        // Initialize test
        async function initTest() {
            try {
                // Check authentication
                currentUser = await new Promise((resolve, reject) => {
                    const unsubscribe = auth.onAuthStateChanged(user => {
                        unsubscribe();
                        if (user) {
                            resolve(user);
                        } else {
                            reject(new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'));
                        }
                    });
                });

                // Get course ID from URL
                courseId = getCourseIdFromUrl();
                
                console.log('Course ID determined:', courseId);
                
                if (!courseId) {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID –∫—É—Ä—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫—É—Ä—Å–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç" –µ—â–µ —Ä–∞–∑.');
                    return;
                }

                // Load course data
                await loadCourseData();

                // Show requirements
                document.getElementById('requirementsInfo').style.display = 'block';

                // Load user progress to check if slides were viewed
                const canTakeTest = await checkTestRequirements();
                
                if (!canTakeTest) {
                    return;
                }

                // Start test
                startTest();

                // Start timer
                startTimer();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showError('–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
            }
        }

        // Get course ID from URL
        function getCourseIdFromUrl() {
            console.log('Getting course ID from URL...');
            
            // 1. Try to get from URL parameters (?id=...)
            const urlParams = new URLSearchParams(window.location.search);
            let courseId = urlParams.get('id');
            
            if (courseId) {
                console.log('Found course ID in URL params:', courseId);
                return courseId;
            }
            
            // 2. Try to extract from URL path
            const path = window.location.pathname;
            console.log('URL path:', path);
            
            // Check if this is test02.html
            if (path.includes('test02.html')) {
                // This is the second course test
                const secondCourseId = '0Jqmw9JvD6lXB1EM1lcD';
                console.log('This is test for second course, ID:', secondCourseId);
                return secondCourseId;
            }
            
            // 3. Fallback for testing
            const fallbackId = '0Jqmw9JvD6lXB1EM1lcD'; // ID –≤—Ç–æ—Ä–æ–≥–æ –∫—É—Ä—Å–∞
            console.log('Using fallback course ID:', fallbackId);
            return fallbackId;
        }

        // Load course data
        async function loadCourseData() {
            try {
                if (!courseId) return;
                
                const courseDoc = await db.collection('courses').doc(courseId).get();
                if (courseDoc.exists) {
                    courseData = courseDoc.data();
                    document.getElementById('testTitle').textContent = `–¢–µ—Å—Ç: ${courseData.title || '–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏'}`;
                    document.getElementById('courseInfo').textContent = courseData.description || '';
                } else {
                    console.warn('Course not found in Firestore, using default title');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–∞:', error);
            }
        }

        // Check test requirements
        async function checkTestRequirements() {
            try {
                const progressDoc = await db.collection('user_progress').doc(currentUser.uid).get();
                if (progressDoc.exists) {
                    const allProgress = progressDoc.data();
                    const courseProgress = allProgress[courseId] || {};
                    
                    // Check if user has viewed all slides
                    if (!courseProgress.slidesViewed || courseProgress.slidesViewed < 100) {
                        showError('–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∫—É—Ä—Å–∞ (100% —Å–ª–∞–π–¥–æ–≤)');
                        return false;
                    }
                    
                    // Check if user already passed the test
                    if (courseProgress.testPassed) {
                        showTestAlreadyPassed(courseProgress.testScore);
                        return false;
                    }
                    
                    return true;
                } else {
                    showError('–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–π–¥–∏—Ç–µ –∫—É—Ä—Å —Å–Ω–∞—á–∞–ª–∞.');
                    return false;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π:', error);
                // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç–µ—Å—Ç
                console.log('Allowing test for debugging purposes');
                return true;
            }
        }

        // Start test
        function startTest() {
            document.getElementById('totalQuestions').textContent = testQuestions.length;
            document.getElementById('totalQuestionsNum').textContent = testQuestions.length;
            
            displayQuestion();
            document.getElementById('navigation').style.display = 'flex';
            updateProgressBar();
        }

        // Display current question
        function displayQuestion() {
            const question = testQuestions[currentQuestionIndex];
            const testContent = document.getElementById('testContent');
            
            let optionsHTML = '';
            question.options.forEach(option => {
                const isSelected = userAnswers[question.id] === option.id;
                optionsHTML += `
                    <div class="option ${isSelected ? 'selected' : ''}" 
                         onclick="selectAnswer(${question.id}, '${option.id}')">
                        <div class="option-label">${option.id.toUpperCase()}</div>
                        <div class="option-text">${option.text}</div>
                    </div>
                `;
            });
            
            testContent.innerHTML = `
                <div class="question-container">
                    <div class="question active">
                        <div class="question-number">
                            <i class="fas fa-question-circle"></i>
                            <span>–í–æ–ø—Ä–æ—Å ${question.id}</span>
                        </div>
                        <div class="question-text">${question.question}</div>
                        <div class="options">
                            ${optionsHTML}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('currentQuestionNum').textContent = currentQuestionIndex + 1;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').innerHTML = 
                currentQuestionIndex === testQuestions.length - 1 
                    ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç <i class="fas fa-check"></i>' 
                    : '–î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>';
        }

        // Select answer
        function selectAnswer(questionId, answerId) {
            userAnswers[questionId] = answerId;
            displayQuestion();
            updateProgressBar();
        }

        // Next question
        function nextQuestion() {
            if (currentQuestionIndex < testQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                submitTest();
            }
        }

        // Previous question
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const answeredCount = Object.keys(userAnswers).length;
            const progress = (answeredCount / testQuestions.length) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${progress}%`;
            
            // Change color based on progress
            if (progress >= 100) {
                progressBar.style.background = '#2ecc71';
            } else if (progress >= 50) {
                progressBar.style.background = '#f39c12';
            } else {
                progressBar.style.background = '#3498db';
            }
        }

        // Start timer
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitTest();
                }
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `‚è∞ ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Submit test
        async function submitTest() {
            if (testCompleted) return;
            testCompleted = true;
            
            clearInterval(timerInterval);
            
            // Calculate results
            const totalQuestions = testQuestions.length;
            let correctCount = 0;
            let incorrectQuestions = [];
            
            testQuestions.forEach(question => {
                const userAnswer = userAnswers[question.id];
                const correctAnswer = correctAnswers[question.id];
                
                if (userAnswer === correctAnswer) {
                    correctCount++;
                } else {
                    incorrectQuestions.push({
                        question: question.question,
                        userAnswer: userAnswer,
                        correctAnswer: correctAnswer
                    });
                }
            });
            
            const score = Math.round((correctCount / totalQuestions) * 100);
            const passed = score >= 100; // 100% required
            
            try {
                // Save results to Firestore
                await saveTestResults(score, passed, correctCount);
                
                // Update progress if passed
                if (passed) {
                    await updateUserProgress(score);
                }
                
                // Display results
                displayResults(score, passed, correctCount, totalQuestions, incorrectQuestions);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞:', error);
                displayResults(score, passed, correctCount, totalQuestions, incorrectQuestions);
            }
        }

        // Save test results to Firestore
        async function saveTestResults(score, passed, correctCount) {
            try {
                const resultId = `${currentUser.uid}_${courseId}_${Date.now()}`;
                const resultData = {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: currentUser.displayName || currentUser.email.split('@')[0],
                    courseId: courseId,
                    courseTitle: courseData?.title || '–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
                    score: score,
                    passed: passed,
                    correctAnswers: correctCount,
                    totalQuestions: testQuestions.length,
                    answers: userAnswers,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    completedAt: new Date().toISOString(),
                    timeSpent: (60 * 60) - timeLeft // in seconds
                };
                
                await db.collection('test_results').doc(resultId).set(resultData);
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', resultId);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                throw error;
            }
        }

        // Update user progress
        async function updateUserProgress(score) {
            try {
                const progressDocRef = db.collection('user_progress').doc(currentUser.uid);
                
                const progressUpdate = {
                    [courseId]: {
                        testPassed: true,
                        testScore: score,
                        testCompletedAt: new Date().toISOString(),
                        lastActivity: firebase.firestore.FieldValue.serverTimestamp(),
                        answers: userAnswers
                    }
                };
                
                await progressDocRef.set(progressUpdate, { merge: true });
                console.log('–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
                throw error;
            }
        }

        // Display results
        function displayResults(score, passed, correctCount, totalQuestions, incorrectQuestions = []) {
            const testContent = document.getElementById('testContent');
            const navigation = document.getElementById('navigation');
            const requirementsInfo = document.getElementById('requirementsInfo');
            
            navigation.style.display = 'none';
            if (requirementsInfo) requirementsInfo.style.display = 'none';
            
            let resultHTML = `
                <div class="results-container">
                    <div class="score-circle ${passed ? 'score-passed' : 'score-failed'}">
                        <div class="score-percent">${score}%</div>
                        <div class="score-label">${passed ? '–°–î–ê–ù–û' : '–ù–ï –°–î–ê–ù–û'}</div>
                    </div>
                    <h2 style="font-size: 32px; margin-bottom: 15px;">${passed ? 'üéâ –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω!' : '‚ùå –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω'}</h2>
                    <p style="font-size: 18px; color: #666; margin-bottom: 30px;">
                        ${passed ? '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.' : '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—ã –Ω–µ –Ω–∞–±—Ä–∞–ª–∏ 100% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.'}
                    </p>
                    
                    <div class="results-details">
                        <div class="result-item">
                            <span><i class="fas fa-check-circle" style="color: #2ecc71;"></i> –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</span>
                            <span><strong>${correctCount} –∏–∑ ${totalQuestions}</strong></span>
                        </div>
                        <div class="result-item">
                            <span><i class="fas fa-percentage" style="color: #3498db;"></i> –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</span>
                            <span><strong>${score}%</strong></span>
                        </div>
                        <div class="result-item">
                            <span><i class="fas fa-target" style="color: #e74c3c;"></i> –¢—Ä–µ–±—É–µ–º—ã–π –º–∏–Ω–∏–º—É–º:</span>
                            <span><strong>100%</strong></span>
                        </div>
                        <div class="result-item">
                            <span><i class="fas fa-flag" style="color: #9b59b6;"></i> –°—Ç–∞—Ç—É—Å:</span>
                            <span><strong style="color: ${passed ? '#2ecc71' : '#e74c3c'}">${passed ? '–ü–†–û–ô–î–ï–ù' : '–ù–ï –ü–†–û–ô–î–ï–ù'}</strong></span>
                        </div>
                    </div>
            `;
            
            if (passed) {
                resultHTML += `
                    <button class="certificate-btn" onclick="generateCertificate(${score})">
                        <i class="fas fa-award"></i> –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                    </button>
                    <p style="color: #666; margin-top: 20px; font-size: 16px;">
                        <i class="fas fa-info-circle" style="color: #3498db;"></i>
                        –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º
                    </p>
                `;
            } else {
                resultHTML += `
                    <div style="margin: 30px 0;">
                        <h3 style="color: #e74c3c; margin-bottom: 15px;">
                            <i class="fas fa-exclamation-triangle"></i> –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:
                        </h3>
                        <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                            ${incorrectQuestions.map((item, index) => `
                                <div style="background: #ffebee; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #e74c3c;">
                                    <p><strong>–í–æ–ø—Ä–æ—Å ${index + 1}:</strong> ${item.question}</p>
                                    <p style="color: #e74c3c;"><i class="fas fa-times"></i> –í–∞—à –æ—Ç–≤–µ—Ç: ${item.userAnswer ? item.userAnswer.toUpperCase() : '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞'}</p>
                                    <p style="color: #2ecc71;"><i class="fas fa-check"></i> –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${item.correctAnswer.toUpperCase()}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <button class="certificate-btn" onclick="retryTest()" style="background: var(--warning);">
                        <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                    <p style="color: #666; margin-top: 20px; font-size: 16px;">
                        –î–ª—è —É—Å–ø–µ—à–Ω–æ–π —Å–¥–∞—á–∏ —Ç–µ—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
                    </p>
                `;
            }
            
            resultHTML += `
                    <div style="margin-top: 40px; display: flex; justify-content: center; gap: 20px;">
                        <button onclick="window.location.href='https://qhse-training.github.io/hse-course/courses.html'" 
                                style="padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-arrow-left"></i> –ö —Å–ø–∏—Å–∫—É –∫—É—Ä—Å–æ–≤
                        </button>
                        <button onclick="window.location.href='https://qhse-training.github.io/hse-course/${courseData?.folderName || '1.02.Hierarchy_of_hazard_controls'}/course02.html?id=${courseId}'" 
                                style="padding: 12px 25px; background: var(--secondary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-book"></i> –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫—É—Ä—Å
                        </button>
                    </div>
                </div>
            `;
            
            testContent.innerHTML = resultHTML;
        }

        // Show test already passed
        function showTestAlreadyPassed(score) {
            const testContent = document.getElementById('testContent');
            const navigation = document.getElementById('navigation');
            const requirementsInfo = document.getElementById('requirementsInfo');
            
            navigation.style.display = 'none';
            if (requirementsInfo) requirementsInfo.style.display = 'none';
            
            testContent.innerHTML = `
                <div class="results-container">
                    <div class="score-circle score-passed">
                        <div class="score-percent">${score}%</div>
                        <div class="score-label">–£–ñ–ï –°–î–ê–ù–û</div>
                    </div>
                    <h2 style="font-size: 32px; margin-bottom: 15px;">üéâ –í—ã —É–∂–µ –ø—Ä–æ—à–ª–∏ —ç—Ç–æ—Ç —Ç–µ—Å—Ç!</h2>
                    <p style="font-size: 18px; color: #666; margin-bottom: 30px;">
                        –í—ã —É–∂–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ —ç—Ç–æ—Ç —Ç–µ—Å—Ç ${score}%. –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
                    </p>
                    
                    <button class="certificate-btn" onclick="showExistingCertificate()">
                        <i class="fas fa-award"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                    </button>
                    
                    <div style="margin-top: 40px;">
                        <button onclick="window.location.href='https://qhse-training.github.io/hse-course/courses.html'" 
                                style="padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; margin: 0 auto;">
                            <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—É—Ä—Å–∞–º
                        </button>
                    </div>
                </div>
            `;
        }

        // Show existing certificate
        async function showExistingCertificate() {
            try {
                const progressDoc = await db.collection('user_progress').doc(currentUser.uid).get();
                if (progressDoc.exists) {
                    const allProgress = progressDoc.data();
                    const courseProgress = allProgress[courseId] || {};
                    
                    if (courseProgress.certificateId) {
                        await showCertificate(
                            courseProgress.certificateId,
                            courseProgress.certificateScore || 100,
                            courseProgress.certificateDate || new Date().toISOString()
                        );
                    } else {
                        // Generate new certificate if not exists
                        await generateCertificate(courseProgress.testScore || 100);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞');
            }
        }

        // Generate certificate
        async function generateCertificate(score) {
            try {
                // Generate unique certificate ID
                const certificateId = 'CERT-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                
                // Get user data
                const userDoc = await db.collection('approved_users').doc(currentUser.uid).get();
                const userData = userDoc.exists ? userDoc.data() : {};
                const userName = userData.fullName || currentUser.displayName || currentUser.email.split('@')[0];
                
                // Get course data
                const courseTitle = courseData?.title || '–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏';
                
                // Update progress with certificate
                await db.collection('user_progress').doc(currentUser.uid).set({
                    [courseId]: {
                        certificateGenerated: true,
                        certificateId: certificateId,
                        certificateDate: new Date().toISOString(),
                        certificateScore: score,
                        certificateDownloaded: true
                    }
                }, { merge: true });
                
                // Save certificate to certificates collection
                await db.collection('certificates').doc(certificateId).set({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: userName,
                    courseId: courseId,
                    courseTitle: courseTitle,
                    score: score,
                    certificateId: certificateId,
                    issueDate: new Date().toISOString(),
                    issuedBy: 'QHSE-Solutions.kz',
                    status: 'active'
                });
                
                // Show certificate
                await showCertificate(certificateId, score);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }

        // Show certificate
        async function showCertificate(certificateId, score, certificateDate = null) {
            // Get user data
            const userDoc = await db.collection('approved_users').doc(currentUser.uid).get();
            const userData = userDoc.exists ? userDoc.data() : {};
            const userName = userData.fullName || currentUser.displayName || currentUser.email.split('@')[0];
            
            const courseTitle = courseData?.title || '–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏';
            const currentDate = certificateDate ? new Date(certificateDate).toLocaleDateString('ru-RU') : new Date().toLocaleDateString('ru-RU');
            
            const certificateWindow = window.open('', '_blank', 'width=1000,height=800,scrollbars=yes');
            
            certificateWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç - ${courseTitle}</title>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap');
                        
                        body { 
                            font-family: 'Roboto', sans-serif; 
                            padding: 40px; 
                            text-align: center; 
                            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                            min-height: 100vh;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            margin: 0;
                        }
                        
                        .certificate-container {
                            background: white;
                            border-radius: 15px;
                            padding: 50px;
                            width: 900px;
                            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
                            border: 10px solid #2c3e50;
                            position: relative;
                            overflow: hidden;
                        }
                        
                        .certificate-header {
                            margin-bottom: 40px;
                            padding-bottom: 20px;
                            border-bottom: 3px solid #3498db;
                        }
                        
                        .certificate-title {
                            font-family: 'Playfair Display', serif;
                            font-size: 48px;
                            font-weight: 700;
                            color: #2c3e50;
                            margin: 0;
                            letter-spacing: 3px;
                            text-transform: uppercase;
                        }
                        
                        .certificate-subtitle {
                            font-size: 20px;
                            color: #7f8c8d;
                            margin-top: 15px;
                            font-weight: 300;
                        }
                        
                        .certificate-content {
                            margin: 40px 0;
                            padding: 30px;
                            background: #f8f9fa;
                            border-radius: 10px;
                            border-left: 5px solid #3498db;
                        }
                        
                        .certificate-name {
                            font-family: 'Playfair Display', serif;
                            font-size: 36px;
                            color: #e74c3c;
                            margin: 25px 0;
                            font-weight: 700;
                        }
                        
                        .certificate-course {
                            font-size: 28px;
                            color: #2c3e50;
                            margin: 30px 0;
                            font-weight: 500;
                            line-height: 1.4;
                        }
                        
                        .certificate-details {
                            display: flex;
                            justify-content: space-between;
                            margin-top: 50px;
                            padding-top: 30px;
                            border-top: 2px solid #eee;
                        }
                        
                        .detail-item {
                            text-align: center;
                            flex: 1;
                        }
                        
                        .detail-label {
                            font-size: 16px;
                            color: #7f8c8d;
                            margin-bottom: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                        }
                        
                        .detail-value {
                            font-size: 20px;
                            color: #2c3e50;
                            font-weight: 500;
                        }
                        
                        .certificate-footer {
                            margin-top: 60px;
                            padding-top: 30px;
                            border-top: 2px solid #3498db;
                            display: flex;
                            justify-content: space-between;
                            align-items: flex-end;
                        }
                        
                        .signature {
                            text-align: center;
                        }
                        
                        .signature-line {
                            width: 200px;
                            height: 1px;
                            background: #2c3e50;
                            margin: 20px auto;
                        }
                        
                        .issued-by {
                            font-size: 18px;
                            color: #2c3e50;
                            font-weight: 500;
                            margin-top: 10px;
                        }
                        
                        .certificate-id {
                            background: #2c3e50;
                            color: white;
                            padding: 10px 20px;
                            border-radius: 5px;
                            font-family: monospace;
                            font-size: 14px;
                            letter-spacing: 1px;
                            display: inline-block;
                            margin-top: 20px;
                        }
                        
                        .watermark {
                            position: absolute;
                            opacity: 0.03;
                            font-size: 200px;
                            transform: rotate(-45deg);
                            top: 30%;
                            left: 10%;
                            white-space: nowrap;
                            color: #2c3e50;
                            font-family: 'Playfair Display', serif;
                            font-weight: 700;
                            z-index: 0;
                        }
                        
                        .seal {
                            position: absolute;
                            top: 50px;
                            right: 50px;
                            width: 120px;
                            height: 120px;
                            border: 3px solid #e74c3c;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-family: 'Playfair Display', serif;
                            font-size: 14px;
                            font-weight: 700;
                            color: #e74c3c;
                            text-align: center;
                            padding: 10px;
                            background: rgba(255,255,255,0.9);
                            transform: rotate(15deg);
                        }
                        
                        .print-btn {
                            background: #3498db;
                            color: white;
                            border: none;
                            padding: 12px 25px;
                            border-radius: 5px;
                            font-size: 16px;
                            cursor: pointer;
                            margin-top: 30px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            margin-left: auto;
                            margin-right: auto;
                        }
                        
                        .print-btn:hover {
                            background: #2980b9;
                        }
                        
                        @media print {
                            body {
                                background: white !important;
                            }
                            .certificate-container {
                                box-shadow: none !important;
                                border: 15px solid #2c3e50 !important;
                                margin: 0;
                                padding: 30px;
                            }
                            .print-btn {
                                display: none !important;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="certificate-container">
                        <div class="watermark">–°–ï–†–¢–ò–§–ò–ö–ê–¢</div>
                        <div class="seal">
                            QHSE<br>SOLUTIONS
                        </div>
                        
                        <div class="certificate-header">
                            <h1 class="certificate-title">–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</h1>
                            <p class="certificate-subtitle">–ù–∞—Å—Ç–æ—è—â–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ</p>
                        </div>
                        
                        <div class="certificate-content">
                            <div class="certificate-name">${userName}</div>
                            <p style="font-size: 20px; margin: 20px 0;">—É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à—ë–ª(–∞) –∫—É—Ä—Å –æ–±—É—á–µ–Ω–∏—è –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ</p>
                            <div class="certificate-course">"${courseTitle}"</div>
                            <p style="font-size: 16px; color: #7f8c8d; margin-top: 20px;">
                                –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: <strong>${score}%</strong>
                            </p>
                        </div>
                        
                        <div class="certificate-details">
                            <div class="detail-item">
                                <div class="detail-label">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</div>
                                <div class="detail-value">${currentDate}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ID —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</div>
                                <div class="detail-value">${certificateId}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">–°—Ç–∞—Ç—É—Å</div>
                                <div class="detail-value" style="color: #2ecc71;">–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω</div>
                            </div>
                        </div>
                        
                        <div class="certificate-footer">
                            <div class="signature">
                                <div class="signature-line"></div>
                                <div class="issued-by">–í—ã–¥–∞–Ω–æ: QHSE-Solutions.kz</div>
                                <div style="color: #7f8c8d; font-size: 14px; margin-top: 5px;">–¶–µ–Ω—Ç—Ä –æ–±—É—á–µ–Ω–∏—è –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: #3498db; letter-spacing: 2px;">QHSE-SOLUTIONS</div>
                                <div style="color: #7f8c8d; font-size: 14px; margin-top: 5px;">–û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞ –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
                            </div>
                        </div>
                        
                        <div class="certificate-id">ID: ${certificateId}</div>
                        
                        <button class="print-btn" onclick="window.print()">
                            <i class="fas fa-print"></i> –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                        </button>
                    </div>
                </body>
                </html>
            `);
            
            certificateWindow.focus();
        }

        // Retry test
        function retryTest() {
            window.location.reload();
        }

        // Show error
        function showError(message) {
            const testContent = document.getElementById('testContent');
            testContent.innerHTML = `
                <div class="results-container">
                    <div style="color: var(--error); font-size: 48px; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h2 style="color: var(--error); margin-bottom: 20px;">–û—à–∏–±–∫–∞</h2>
                    <p style="font-size: 18px; color: #666; margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                        ${message}
                    </p>
                    <div style="margin-top: 30px;">
                        <button onclick="window.location.href='https://qhse-training.github.io/hse-course/courses.html'" 
                                style="padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; margin: 0 auto;">
                            <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—É—Ä—Å–∞–º
                        </button>
                    </div>
                </div>
            `;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initTest();
        });

        // Handle keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            switch(e.key) {
                case 'ArrowLeft':
                    prevQuestion();
                    break;
                case 'ArrowRight':
                case ' ':
                    e.preventDefault();
                    nextQuestion();
                    break;
                case 'Enter':
                    if (currentQuestionIndex === testQuestions.length - 1) {
                        submitTest();
                    }
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    const answer = e.key.toLowerCase();
                    if (['a', 'b', 'c', 'd'].includes(answer)) {
                        selectAnswer(testQuestions[currentQuestionIndex].id, answer);
                    }
                    break;
            }
        });
    </script>
</body>
</html>